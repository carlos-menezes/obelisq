import { TParseEnvironmentReturnType } from "./parser";

type TGenerateObelisqFileParams = {
  entries: TParseEnvironmentReturnType;
};

const generateEnvironmentKeysType = ({
  entries,
}: Pick<TGenerateObelisqFileParams, "entries">) => {
  return `export type TObelisqEnvironmentKeys = {
  ${Object.entries(entries)
    .map(([key, { metadata }]) => `${key}: ${metadata.type};`)
    .join("\n  ")}
};`;
};

export const generateObelisqFile = ({
  entries,
}: TGenerateObelisqFileParams) => {
  return `// This file is generated by the Obelisq CLI. Do not edit it manually.
${generateEnvironmentKeysType({ entries })}

export const environment = <TKey extends keyof TObelisqEnvironmentKeys>(key: TKey) => {
  return process.env[key as string] as TObelisqEnvironmentKeys[TKey];
};`;
};
